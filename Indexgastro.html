<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Feels and Taste</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ff6600">
</head>
<body>
  <h1>üç¥ Bienvenido a Feels and Taste</h1>

  <script>
    // Men√∫ con ingredientes, preparaci√≥n e historia
    const menu = [
      {
        nombre: "Api con Pastel",
        ingredientes: "Api de ma√≠z morado, agua, clavo de olor, ma√≠z morado molido, c√°scara de naranja, panela o az√∫car morena, canela, harina, manteca, queso fresco, az√∫car granulada, az√∫car impalpable y aceite.",
        preparacion: "El api se prepara hirviendo agua con ma√≠z morado, canela, clavo de olor y c√°scara de naranja. Luego se cuela y se endulza con panela. El pastel se hace con harina, manteca, queso fresco y az√∫car, formando masas que se fr√≠en hasta dorar y se espolvorean con az√∫car impalpable.",
        historia: "La historia del api con pastel se origina en el occidente boliviano, donde es una tradici√≥n para el desayuno o la noche. El api es una bebida ancestral de ma√≠z morado, mientras que el pastel es un pastelito frito relleno de queso y cubierto de az√∫car."
      },
      {
        nombre: "Wallake",
        ingredientes: "Pescado carachi, koa, papas andinas, chu√±o, aj√≠ amarillo, cebolla, ajo, sal, comino y caldo de pescado.",
        preparacion: "Primero se hierve el caldo con papas y chu√±o. Se hace un sofrito de cebolla, ajo y aj√≠, que se a√±ade al caldo. Luego se incorpora el pescado hasta cocerlo sin deshacerse y se aromatiza con koa. Se sirve con papa y chu√±o enteros.",
        historia: "El wallake es un plato t√≠pico de la regi√≥n andina de Bolivia y Per√∫, muy arraigado especialmente en las comunidades cercanas al Lago Titicaca. Su historia est√° vinculada a la tradici√≥n gastron√≥mica ancestral de los pueblos aymaras y quechuas."
      },
      {
        nombre: "Sajta",
        ingredientes: "Pollo, cebolla, ajo, arvejas, pimienta, comino, aj√≠ amarillo molido, papas, tunta, quesillo fresco, huevos, tomate, aceite y sal.",
        preparacion: "Se hierve el pollo y se prepara una salsa con cebolla, ajo, arvejas, pimienta, comino y aj√≠ amarillo disuelto en caldo. Se mezcla el pollo con la salsa. Aparte se cuecen papas y tunta, que se combinan con queso y huevo. Se acompa√±a con una ensalada de cebolla y tomate.",
        historia: "La sajta de pollo es uno de los platos m√°s representativos de la cocina boliviana, especialmente en el altiplano. Es una preparaci√≥n hogare√±a que combina pollo tierno, aj√≠ amarillo y tunta, en una salsa espesa y arom√°tica."
      },
      {
        nombre: "Helado de Canela",
        ingredientes: "Agua, az√∫car granulada, canela, maicena y jugo de lim√≥n.",
        preparacion: "Se hierve agua con canela, se a√±ade az√∫car y maicena disuelta en agua fr√≠a, se cocina unos minutos y se enfr√≠a. Luego se incorpora jugo de lim√≥n y se congela, batiendo varias veces hasta obtener la textura de helado.",
        historia: "Los helados de canela, originados en La Paz y Oruro a inicios del siglo veinte, son un postre tradicional que despierta nostalgia. Se venden en lugares emblem√°ticos como la Plaza Triangular, el Estadio Hernando Siles y el Mercado Lanza."
      }
    ];

    let currentDish = 0;
    let paused = false;
    let lastPart = "inicio"; // para repetir partes espec√≠ficas

    function hablar(texto, callback = null) {
      const utterance = new SpeechSynthesisUtterance(texto);
      utterance.lang = "es-ES";
      utterance.rate = 0.9;
      utterance.pitch = 1.2;
      if (callback) utterance.onend = callback;
      speechSynthesis.speak(utterance);
    }

    // Inicia la app
    window.onload = () => {
      hablar("Bienvenido a Feels and Taste. El men√∫ de hoy tiene cuatro platos. Diga continuar para empezar.");
      iniciarEscucha();
    };

    // Lee un plato completo
    function leerPlato() {
      if (currentDish < menu.length) {
        const plato = menu[currentDish];
        hablar(`Ahora serviremos ${plato.nombre}.`, () => {
          lastPart = "ingredientes";
          hablar(`Ingredientes: ${plato.ingredientes}`, () => {
            lastPart = "preparacion";
            hablar(`Preparaci√≥n: ${plato.preparacion}`, () => {
              lastPart = "historia";
              hablar(`Historia: ${plato.historia}`, () => {
                hablar("Cuando termine de disfrutar este plato, diga esperar o diga continuar.");
              });
            });
          });
        });
      } else {
        hablar("El men√∫ ha finalizado. Gracias por disfrutar con Feels and Taste.");
      }
    }

    // Reconocimiento de voz
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = "es-ES";
    recognition.continuous = true;
    recognition.interimResults = false;

    recognition.onresult = (event) => {
      const transcript = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
      console.log("Comando reconocido:", transcript);

      if (transcript.includes("continuar")) {
        if (paused) {
          paused = false;
          currentDish++;
          leerPlato();
        } else if (currentDish === 0) {
          leerPlato();
        }
      }

      if (transcript.includes("esperar") || transcript.includes("pausar")) {
        paused = true;
        speechSynthesis.cancel();
        hablar("He pausado la lectura. Diga continuar cuando desee seguir con el siguiente plato.");
      }

      if (transcript.includes("repetir")) {
        speechSynthesis.cancel();
        const plato = menu[currentDish];
        if (lastPart === "ingredientes") {
          hablar(`Ingredientes: ${plato.ingredientes}`);
        } else if (lastPart === "preparacion") {
          hablar(`Preparaci√≥n: ${plato.preparacion}`);
        } else if (lastPart === "historia") {
          hablar(`Historia: ${plato.historia}`);
        }
      }

      if (transcript.includes("volver al principio")) {
        speechSynthesis.cancel();
        currentDish = 0;
        hablar("Regresando al inicio del men√∫. Diga continuar para empezar de nuevo.");
      }
    };

    function iniciarEscucha() {
      recognition.start();
    }

    // Botones accesibles
    document.addEventListener("keydown", (e) => {
      if (e.key === "c") leerPlato();
      if (e.key === "e") paused = true;
    });
  </script>

  <div>
    <button onclick="leerPlato()">‚ñ∂Ô∏è Continuar</button>
    <button onclick="paused=true; speechSynthesis.cancel();">‚è∏Ô∏è Pausar</button>
    <button onclick="currentDish=0; hablar('Regresando al inicio. Diga continuar para empezar de nuevo.');">üîÑ Reiniciar</button>
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
</body>
</html>
